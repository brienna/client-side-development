
<head>
    <style> 
        body {
            background-color: lightgray;
        }

    </style>
</head>

<body>
    <p id="name">Welcome! </p>
    <form>
    </form>

    <script>
        // Access form 
        var form = document.getElementsByTagName('form')[0];
        var p = document.getElementById('name');

        // Show or request user name
        // If browser supports window.localStorage, 
        if (window.localStorage) {
            var name; 
            // Check if name has been saved, then show
            if (window.localStorage.name) {
                name = window.localStorage.name;
                showName();
            } else {
                // If not, prompt user for name, then save
                p.firstChild.nodeValue = "Welcome! Who are you? ";
                showName();
            }

            function changeName() {
                var nameInput = document.createElement('input');
                var nameSubmit = document.createElement('button');
                nameSubmit.appendChild(document.createTextNode('Submit'));
                p.appendChild(nameInput);
                p.appendChild(nameSubmit);
                nameSubmit.addEventListener('click', function() {
                    // Trim white spaces from beginning & end of input
                    name = nameInput.value.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
                    // If empty string, prompt user again for name
                    p.removeChild(nameSubmit);
                    p.removeChild(nameInput);
                    if (name.length == 0) {
                        changeName();
                    } else {
                        window.localStorage.name = name;
                        showName();
                    }
                });
            }

            function showName() {
                // Show name
                p.firstChild.nodeValue = "Welcome, " + name + "! ";
                // Give user option to change name again
                var a = document.createElement('a');
                a.appendChild(document.createTextNode('(Not you?)'));
                a.setAttribute('href', '#');
                a.onclick = function() {
                    p.removeChild(a);
                    p.firstChild.nodeValue = "Welcome! Who are you? ";
                    changeName(); 
                    return false; 
                }
                p.appendChild(a);
            }
        } 

        var optionTexts = {
            1: {
                "Choose gender": null, 
                "M": 
                    {"Facial hair?": null,
                    "H": 
                        {"Complexion?": null,
                        "D": null, 
                        "L": null}, 
                    "NH": 
                        {"Build?": null,
                        "B": null, 
                        "S": null}
                    },
                "W": 
                    {"Blonde/Brunette?": null, 
                    "Blonde": 
                        {"Height?": null,
                            "T": null, 
                            "S": null},
                    "Brunette":
                        {"Eyes?": null,
                        "Br": null, 
                        "Bl": null}
                    }
            }
        };

        
        var currNode;
        var activeSelectId; // keeps track of <select> elements
        window.onload = function() {
            // Set optionTexts node 'pointer' to first node
            activeSelectId = 1;
            currNode = optionTexts[1];
            createDropMenu(Object.keys(currNode), activeSelectId);
        };

        // Creates all of the dropdowns
        function createDropMenu(texts, id) {
            console.log("creating select #" + id + " with " + texts);
            var select = document.createElement("select");
            select.name = id;
            select.onchange = function() { 
                getNext(this); 
            };
            
            // For each text,
            for (var i = 0; i < texts.length; i++) {
                // Create <option>
                var option = document.createElement("option");
                // Create text node for <option>
                var optionText = document.createTextNode(texts[i]);
                // Assign same text to value attr of <option> 
                option.value = texts[i];
                // Append text node to <option> 
                option.appendChild(optionText);
                // Append <option> to <select> 
                select.appendChild(option);
            }
            
            // Add the new dropdown menu to the form with animation
            select.style.opacity = 0;
            form.appendChild(select);
            fadeIn(select);
        }



        // Search for next options based on the option selected
        function getNext(select) {
            console.log(" ");
            console.log("selected " + select.name);

            // Clear any <select>s after current <select>
            selectsLive = form.getElementsByTagName('select');
            selects = form.querySelectorAll('select');
            console.log("there are this amount of selects: "+selects.length);
            for (var i = 0; i < selects.length; i++) {
                console.log(selects[i].name + " " + select.name);
                if (selects[i].name > select.name) {
                    console.log("clearing " + selects[i].name);
                    form.removeChild(selectsLive.namedItem(selects[i].name));
                }
            }

            // Search data structure for matching selection, beginning with first node
            navigate(optionTexts[1]);

            function navigate(node) {
                // If node is null, stop navigating
                if (node == null) {
                    return;
                }

                for (var key in node) {
                    if (node[key] != null && key == select.value) {
                        currNode = node[key];
                        activeSelectId = Number(select.name) + 1;
                        createDropMenu(Object.keys(currNode), activeSelectId);
                        return;
                    } else {
                        navigate(node[key]);
                    }
                }
            }
        };


        function fadeIn(e) {
            // Incremental animation
            var tick = function() {
                e.style.opacity = +e.style.opacity + 0.05;
                    if (+e.style.opacity < 1) {
                        // If the browser supports window.requestAnimationFrame
                        if (window.requestAnimationFrame) {
                            window.requestAnimationFrame(tick);
                        } else {
                            setTimeout(tick, 16);
                        }
                    }
            };
            // Begin animation
            tick();
        }

        
    </script>
</body>



